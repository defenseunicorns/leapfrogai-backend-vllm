kind: ZarfPackageConfig

metadata:
  name: "###ZARF_PKG_TMPL_NAME###"
  version: "###ZARF_PKG_TMPL_IMAGE_VERSION###"

description: >
  VLLM model

constants:
  - name: IMAGE_VERSION
    value: "###ZARF_PKG_TMPL_IMAGE_VERSION###"
  - name: NAME
    value: "###ZARF_PKG_TMPL_NAME###"

variables:
  - name: MAX_CONTEXT_LENGTH
    default: "32768"
  - name: DEFAULTS_TOP_P
    default: "1.0"
  - name: DEFAULTS_TOP_K
    default: "0"

components:
  - name: import-model
    required: true
    import:
      name: model
      url: oci://ghcr.io/defenseunicorns/packages/leapfrogai/leapfrogai-model:0.4.2
    manifests:
      - name: vllm-configmap
        namespace: leapfrogai
        files:
          - manifests/configmap.yaml
    files:
      - source: patches/deployment.yaml
        target: patches/deployment.yaml
    actions:
      onDeploy:
        onSuccess:
          - cmd: kubectl patch deployment vllm-model-vllm --patch "$(cat patches/deployment.yaml)" -n leapfrogai